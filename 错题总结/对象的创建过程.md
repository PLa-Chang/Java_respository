## 对象的创建过程
### Step1:类加载检查

    虚拟机遇到一条 new 指令时，首先检测类是否已被加载过、解析和初始化过。如果没有，那必须先执行相应的类加载过程。
### Step2:分配内存

    在类加载检查通过后，接下来虚拟机将为新生对象分配内存。对象所需的内存大小在类加载完成后便可确定，为对象分配空间的任务等同于把一块确定大小的内存从 Java 堆中划分出来。分配方式有 “指针碰撞” 和 “空闲列表” 两种，选择哪种分配方式由 Java 堆是否规整决定，而 Java 堆是否规整又由所采用的垃圾收集器是否带有压缩整理功能决定。

    - 指针碰撞
        - 适用场合：堆内存规整（即没有内存碎片）的情况下。
        - 原理：用过的内存全部整合到一边，没有用过的内存放在另一边，中间有一个分界指针，只需要向着没用过的内存方向将该指针移动对象内存大小位置即可。
    - 空闲列表
        - 适用场合：堆内存不规整的情况下。
        - 原理：虚拟机会维护一个列表，该列表中会记录哪些内存块是可用的，在分配的时候，找一块儿足够大的内存块儿来划分给对象实例，最后更新列表记录。
### Step3:初始化零值

    内存分配完成后，虚拟机需要将分配到的内存空间都初始化为零值，这一步操
作保证了对象的实例字段在 Java 代码中可以不赋初始值就直接使用，程序能访
问到这些字段的数据类型所对应的零值。
### Step4:设置对象头（了解即可）

    初始化零值完成之后，虚拟机要对对象进行必要的设置，例如这个对象是哪个
类的实例、如何才能找到类的元数据信息、对象的哈希码、对象的 GC 分代年龄
等信息。 这些信息存放在对象头中。 另外，根据虚拟机当前运行状态的不同，
如是否启用偏向锁等，对象头会有不同的设置方式。
### Step5:执行 init 方法

    在上面工作都完成之后，从虚拟机的视角来看，一个新的对象已经产生了，但
从 Java 程序的视角来看，对象创建才刚开始， <init> 方法还没有执行，所有
的字段都还为零。所以一般来说，执行 new 指令之后会接着执行 <init> 方
法，把对象按照程序员的意愿进行初始化，这样一个真正可用的对象才算完全
产生出来。

### 对象的创建过程就是类的声明周期中的 **使用** 阶段
![对象的创建过程](../image/%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B.png)